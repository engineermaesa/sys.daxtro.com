CREATE TABLE "migrations" ("id" integer primary key autoincrement not null, "migration" varchar not null, "batch" integer not null)
CREATE TABLE sqlite_sequence(name,seq)
CREATE TABLE "ref_companies" ("id" integer primary key autoincrement not null, "name" varchar, "address" text, "phone" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "ref_banks" ("id" integer primary key autoincrement not null, "name" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "ref_accounts" ("id" integer primary key autoincrement not null, "company_id" integer not null, "bank_id" integer not null, "account_number" varchar, "holder_name" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("company_id") references "ref_companies"("id") on delete restrict on update restrict, foreign key("bank_id") references "ref_banks"("id") on delete restrict on update restrict)
CREATE TABLE "ref_product_categories" ("id" integer primary key autoincrement not null, "name" varchar, "code" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "ref_parts" ("id" integer primary key autoincrement not null, "name" varchar not null, "price" double not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, "sku" varchar)
CREATE TABLE "ref_product_parts" ("id" integer primary key autoincrement not null, "product_id" integer not null, "part_id" integer not null, "created_at" datetime, "updated_at" datetime, foreign key("product_id") references "ref_products"("id") on delete restrict on update restrict, foreign key("part_id") references "ref_parts"("id") on delete restrict on update restrict)
CREATE TABLE "ref_product_category" ("id" integer primary key autoincrement not null, "product_id" integer not null, "category_id" integer not null, "created_at" datetime, "updated_at" datetime, foreign key("product_id") references "ref_products"("id") on delete restrict on update restrict, foreign key("category_id") references "ref_product_categories"("id") on delete restrict on update restrict)
CREATE TABLE "ref_branches" ("id" integer primary key autoincrement not null, "company_id" integer not null, "name" varchar, "code" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, "address" text, foreign key("company_id") references "ref_companies"("id") on delete restrict on update restrict)
CREATE TABLE "ref_regionals" ("id" integer primary key autoincrement not null, "name" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "ref_provinces" ("id" integer primary key autoincrement not null, "regional_id" integer not null, "name" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("regional_id") references "ref_regionals"("id") on delete restrict on update restrict)
CREATE TABLE "ref_regions" ("id" integer primary key autoincrement not null, "regional_id" integer not null, "province_id" integer not null, "branch_id" integer not null, "name" varchar, "code" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("regional_id") references "ref_regionals"("id") on delete restrict on update restrict, foreign key("province_id") references "ref_provinces"("id") on delete restrict on update restrict, foreign key("branch_id") references "ref_branches"("id") on delete restrict on update restrict)
CREATE TABLE "ref_expense_types" ("id" integer primary key autoincrement not null, "name" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "user_roles" ("id" integer primary key autoincrement not null, "name" varchar, "code" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "password_reset_tokens" ("email" varchar not null, "token" varchar not null, "created_at" datetime)
CREATE TABLE "user_permissions" ("id" integer primary key autoincrement not null, "name" varchar, "code" varchar, "description" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "user_role_permissions" ("id" integer primary key autoincrement not null, "role_id" integer not null, "permission_id" integer not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("role_id") references "user_roles"("id") on delete restrict on update restrict, foreign key("permission_id") references "user_permissions"("id") on delete restrict on update restrict)
CREATE TABLE "user_activity_logs" ("id" integer primary key autoincrement not null, "user_id" integer, "action" varchar not null, "model_type" varchar, "model_id" integer, "description" text, "data" text, "ip_address" varchar, "user_agent" varchar, "created_at" datetime, "updated_at" datetime, foreign key("user_id") references "users"("id") on delete set null on update cascade)
CREATE TABLE "attachments" ("id" integer primary key autoincrement not null, "type" varchar, "file_path" varchar, "mime_type" varchar, "size" integer, "uploaded_by" integer not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("uploaded_by") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "lead_sources" ("id" integer primary key autoincrement not null, "name" varchar)
CREATE TABLE "lead_segments" ("id" integer primary key autoincrement not null, "name" varchar)
CREATE TABLE "lead_statuses" ("id" integer primary key autoincrement not null, "name" varchar)
CREATE TABLE "lead_notes" ("id" integer primary key autoincrement not null, "lead_id" integer not null, "notes" text, "user_id" integer not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("lead_id") references "leads"("id") on delete restrict on update restrict, foreign key("user_id") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "lead_status_logs" ("id" integer primary key autoincrement not null, "lead_id" integer not null, "status_id" integer not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("lead_id") references "leads"("id") on delete restrict on update restrict, foreign key("status_id") references "lead_statuses"("id") on delete restrict on update restrict)
CREATE TABLE "lead_meeting_reschedules" ("id" integer primary key autoincrement not null, "meeting_id" integer not null, "old_scheduled_start_at" datetime, "old_scheduled_end_at" datetime, "old_online_url" varchar, "new_online_url" varchar, "new_scheduled_start_at" datetime, "new_scheduled_end_at" datetime, "old_location" varchar, "new_location" varchar, "reason" varchar, "rescheduled_by" integer not null, "rescheduled_at" datetime, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("meeting_id") references "lead_meetings"("id") on delete restrict on update restrict, foreign key("rescheduled_by") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "lead_claims" ("id" integer primary key autoincrement not null, "lead_id" integer not null, "sales_id" integer not null, "claimed_at" datetime, "released_at" datetime, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, "trash_note" text, foreign key("lead_id") references "leads"("id") on delete restrict on update restrict, foreign key("sales_id") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "meeting_expenses" ("id" integer primary key autoincrement not null, "meeting_id" integer not null, "sales_id" integer not null, "amount" double not null, "status" varchar check ("status" in ('draft', 'submitted', 'approved', 'rejected', 'canceled')) not null default 'draft', "requested_at" datetime, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("meeting_id") references "lead_meetings"("id") on delete restrict on update restrict, foreign key("sales_id") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "meeting_expense_details" ("id" integer primary key autoincrement not null, "meeting_expense_id" integer not null, "expense_type_id" integer not null, "amount" double not null, "notes" text, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("meeting_expense_id") references "meeting_expenses"("id") on delete cascade on update cascade, foreign key("expense_type_id") references "ref_expense_types"("id") on delete restrict on update restrict)
CREATE TABLE "quotations" ("id" integer primary key autoincrement not null, "lead_id" integer not null, "quotation_no" varchar, "status" varchar check ("status" in ('draft', 'review', 'published', 'rejected', 'expired')), "subtotal" double, "tax_pct" double not null default '11', "tax_total" double, "grand_total" double, "booking_fee" double, "expiry_date" date, "created_by" integer not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("lead_id") references "leads"("id") on delete restrict on update restrict, foreign key("created_by") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "quotation_items" ("id" integer primary key autoincrement not null, "quotation_id" integer not null, "product_id" integer, "qty" double not null default '1', "description" text, "unit_price" double, "discount_pct" double, "line_total" double, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("quotation_id") references "quotations"("id") on delete restrict on update restrict, foreign key("product_id") references "ref_products"("id") on delete restrict on update restrict)
CREATE TABLE "quotation_reviews" ("id" integer primary key autoincrement not null, "quotation_id" integer not null, "reviewer_id" integer not null, "role" varchar check ("role" in ('BM', 'SD')), "decision" varchar check ("decision" in ('approve', 'reject')), "notes" text, "incentive_nominal" numeric not null default '0', "decided_at" datetime, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("quotation_id") references "quotations"("id") on delete restrict on update restrict, foreign key("reviewer_id") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "quotation_payment_terms" ("id" integer primary key autoincrement not null, "quotation_id" integer not null, "term_no" integer not null, "percentage" double not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, "description" varchar, foreign key("quotation_id") references "quotations"("id") on delete restrict on update restrict)
CREATE TABLE "user_balances" ("id" integer primary key autoincrement not null, "user_id" integer not null, "total_balance" double not null default '0', "updated_at" datetime, foreign key("user_id") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "user_balance_logs" ("id" integer primary key autoincrement not null, "user_id" integer not null, "amount" double not null, "quotation_id" integer not null, "description" varchar, "status" varchar check ("status" in ('pending', 'received', 'expired')) not null, "created_at" datetime, foreign key("user_id") references "users"("id") on delete restrict on update restrict, foreign key("quotation_id") references "quotations"("id") on delete restrict on update restrict)
CREATE TABLE "proformas" ("id" integer primary key autoincrement not null, "quotation_id" integer not null, "term_no" integer, "proforma_type" varchar check ("proforma_type" in ('booking_fee', 'down_payment', 'term_payment')), "proforma_no" varchar, "amount" double, "status" varchar check ("status" in ('pending', 'confirmed')), "issued_by" integer, "issued_at" datetime, "attachment_id" integer, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("quotation_id") references "quotations"("id") on delete restrict on update restrict, foreign key("issued_by") references "users"("id") on delete restrict on update restrict, foreign key("attachment_id") references "attachments"("id") on delete restrict on update restrict)
CREATE TABLE "orders" ("id" integer primary key autoincrement not null, "lead_id" integer not null, "order_no" varchar, "total_billing" double, "order_status" varchar check ("order_status" in ('publish', 'in_progress', 'delivered', 'confirmed', 'done', 'canceled')), "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("lead_id") references "leads"("id") on delete restrict on update restrict)
CREATE TABLE "order_items" ("id" integer primary key autoincrement not null, "order_id" integer not null, "product_id" integer, "description" text, "qty" double, "unit_price" double, "discount_pct" double, "tax_pct" double, "line_total" double, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("order_id") references "orders"("id") on delete restrict on update restrict, foreign key("product_id") references "ref_products"("id") on delete restrict on update restrict)
CREATE TABLE "order_payment_terms" ("id" integer primary key autoincrement not null, "order_id" integer not null, "term_no" integer not null, "percentage" double not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("order_id") references "orders"("id") on delete restrict on update restrict)
CREATE TABLE "invoices" ("id" integer primary key autoincrement not null, "proforma_id" integer not null, "invoice_no" varchar, "invoice_type" varchar check ("invoice_type" in ('booking_fee', 'down_payment', 'final')), "amount" double, "due_date" date, "status" varchar check ("status" in ('open', 'paid', 'partial', 'void')), "attachment_id" integer, "issued_at" datetime, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("proforma_id") references "proformas"("id") on delete restrict on update restrict, foreign key("attachment_id") references "attachments"("id") on delete restrict on update restrict)
CREATE TABLE "invoice_items" ("id" integer primary key autoincrement not null, "invoice_id" integer not null, "description" text, "amount" double, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("invoice_id") references "invoices"("id") on delete restrict on update restrict)
CREATE TABLE "invoice_payments" ("id" integer primary key autoincrement not null, "invoice_id" integer not null, "paid_at" datetime, "amount" double, "attachment_id" integer not null, "confirmed_by" integer not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("invoice_id") references "invoices"("id") on delete restrict on update restrict, foreign key("attachment_id") references "attachments"("id") on delete restrict on update restrict, foreign key("confirmed_by") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "users" ("id" integer primary key autoincrement not null, "role_id" integer not null, "company_id" integer, "branch_id" integer, "name" varchar, "email" varchar, "nip" varchar, "phone" varchar, "password" varchar, "remember_token" varchar, "created_by" integer, "updated_by" integer, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("updated_by") references users("id") on delete set null on update no action, foreign key("created_by") references users("id") on delete set null on update no action, foreign key("branch_id") references ref_branches("id") on delete restrict on update restrict, foreign key("company_id") references ref_companies("id") on delete restrict on update restrict, foreign key("role_id") references user_roles("id") on delete restrict on update restrict)
CREATE TABLE "ref_product_types" ("id" integer primary key autoincrement not null, "name" varchar not null, "created_at" datetime, "updated_at" datetime)
CREATE TABLE "ref_products" ("id" integer primary key autoincrement not null, "sku" varchar, "name" varchar, "description" text, "vat" integer, "corporate_price" double, "government_price" double, "personal_price" double, "warranty_available" tinyint(1) not null default ('0'), "warranty_time_month" integer, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, "fob_price" double, "product_type_id" integer, "bdi_price" double, foreign key("product_type_id") references "ref_product_types"("id") on delete set null)
CREATE TABLE "ref_customer_types" ("id" integer primary key autoincrement not null, "name" varchar not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "finance_requests" ("id" integer primary key autoincrement not null, "request_type" varchar check ("request_type" in ('meeting-expense', 'proforma', 'invoice', 'payment-confirmation')), "reference_id" varchar, "requester_id" integer not null, "status" varchar, "approver_id" integer, "decided_at" datetime, "notes" text, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("approver_id") references users("id") on delete restrict on update restrict, foreign key("requester_id") references users("id") on delete restrict on update restrict)
CREATE TABLE "payment_confirmations" ("id" integer primary key autoincrement not null, "proforma_id" integer not null, "payer_name" varchar, "payer_bank" varchar, "payer_account_number" varchar, "paid_at" datetime, "amount" double, "attachment_id" integer not null, "confirmed_by" integer, "confirmed_at" datetime, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("confirmed_by") references users("id") on delete restrict on update restrict, foreign key("attachment_id") references attachments("id") on delete restrict on update restrict, foreign key("proforma_id") references proformas("id") on delete restrict on update restrict)
CREATE TABLE "meeting_types" ("id" integer primary key autoincrement not null, "name" varchar not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "ref_industries" ("id" integer primary key autoincrement not null, "name" varchar not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "ref_jabatans" ("id" integer primary key autoincrement not null, "name" varchar not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "leads" ("id" integer primary key autoincrement not null, "source_id" integer not null, "segment_id" integer, "region_id" integer, "province" varchar, "status_id" integer not null, "name" varchar, "phone" varchar, "email" varchar, "product_id" integer, "needs" varchar, "published_at" datetime, "created_at" datetime, "updated_at" datetime, "branch_id" integer, "first_sales_id" integer, "company" varchar, "customer_type" varchar, "tonase" numeric, "industry_id" integer, "jabatan_id" integer, "other_industry" varchar, foreign key("industry_id") references ref_industries("id") on delete restrict on update restrict, foreign key("first_sales_id") references users("id") on delete restrict on update restrict, foreign key("product_id") references ref_products("id") on delete restrict on update restrict, foreign key("status_id") references lead_statuses("id") on delete restrict on update restrict, foreign key("region_id") references ref_regions("id") on delete restrict on update restrict, foreign key("segment_id") references lead_segments("id") on delete restrict on update restrict, foreign key("source_id") references lead_sources("id") on delete restrict on update restrict, foreign key("branch_id") references ref_branches("id") on delete restrict on update restrict, foreign key("jabatan_id") references "ref_jabatans"("id") on delete restrict on update restrict)
CREATE TABLE "quotation_signed_documents" ("id" integer primary key autoincrement not null, "quotation_id" integer not null, "attachment_id" integer not null, "description" text, "signed_date" date, "uploader_id" integer not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("quotation_id") references "quotations"("id") on delete restrict on update restrict, foreign key("attachment_id") references "attachments"("id") on delete restrict on update restrict, foreign key("uploader_id") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "lead_pic_extensions" ("id" integer primary key autoincrement not null, "lead_id" integer not null, "nama" varchar, "email" varchar, "phone" varchar, "title" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, "jabatan_id" integer, foreign key("lead_id") references leads("id") on delete restrict on update restrict, foreign key("jabatan_id") references "ref_jabatans"("id") on delete restrict on update restrict)
CREATE TABLE "order_progress_logs" ("id" integer primary key autoincrement not null, "order_id" integer not null, "progress_step" varchar, "note" text, "logged_at" datetime, "user_id" integer not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, "attachment_id" integer, foreign key("user_id") references users("id") on delete restrict on update restrict, foreign key("order_id") references orders("id") on delete restrict on update restrict, foreign key("attachment_id") references "attachments"("id") on delete restrict on update restrict)
CREATE TABLE "quotation_logs" ("id" integer primary key autoincrement not null, "quotation_id" integer not null, "action" varchar not null, "user_id" integer not null, "logged_at" datetime, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("quotation_id") references "quotations"("id") on delete restrict on update restrict, foreign key("user_id") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "lead_meetings" ("id" integer primary key autoincrement not null, "lead_id" integer not null, "is_online" tinyint(1), "online_url" varchar, "scheduled_start_at" datetime, "scheduled_end_at" datetime, "city" varchar, "address" varchar, "result" varchar check ("result" in ('yes', 'no', 'expired', 'waiting')), "summary" text, "attachment_id" integer, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, "meeting_type_id" integer, foreign key("meeting_type_id") references meeting_types("id") on delete set null on update no action, foreign key("lead_id") references leads("id") on delete restrict on update restrict, foreign key("attachment_id") references attachments("id") on delete restrict on update restrict)
CREATE TABLE "lead_activity_lists" ("id" integer primary key autoincrement not null, "code" varchar not null, "name" varchar not null, "description" varchar, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime)
CREATE TABLE "payment_logs" ("id" integer primary key autoincrement not null, "quotation_id" integer not null, "proforma_id" integer, "invoice_id" integer, "type" varchar check ("type" in ('confirmation', 'proforma', 'invoice')) not null, "user_id" integer not null, "logged_at" datetime, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, foreign key("quotation_id") references "quotations"("id") on delete restrict on update restrict, foreign key("proforma_id") references "proformas"("id") on delete restrict on update restrict, foreign key("invoice_id") references "invoices"("id") on delete restrict on update restrict, foreign key("user_id") references "users"("id") on delete restrict on update restrict)
CREATE TABLE "lead_activity_logs" ("id" integer primary key autoincrement not null, "lead_id" integer not null, "activity_id" integer not null, "note" text, "logged_at" datetime, "user_id" integer not null, "created_at" datetime, "updated_at" datetime, "deleted_at" datetime, "attachment_id" integer, foreign key("user_id") references users("id") on delete restrict on update restrict, foreign key("activity_id") references lead_activity_lists("id") on delete restrict on update restrict, foreign key("lead_id") references leads("id") on delete restrict on update restrict, foreign key("attachment_id") references "attachments"("id") on delete restrict on update restrict)
CREATE TABLE "cache" ("key" varchar not null, "value" text not null, "expiration" integer not null, primary key ("key"))
CREATE TABLE "cache_locks" ("key" varchar not null, "owner" varchar not null, "expiration" integer not null, primary key ("key"))
